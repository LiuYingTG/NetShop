window.PUBLIC="http://106.14.183.207:8085";var NetShop=angular.module("NetShop",["ngRoute","ngCookies","infinite-scroll","Controllers","Directives"]);function stopPropagation(o){o.stopPropagation?o.stopPropagation():o.cancelBubble=!0}NetShop.config(["$compileProvider",function(o){o.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|file|sms):/)}]),NetShop.config(["$routeProvider","$locationProvider",function(o,t){t.hashPrefix(""),o.when("/allPro/:categoryType",{templateUrl:"./templates/allPro.html",controller:"allProController"}).when("/proDetail/:categoryType/:productId",{templateUrl:"./templates/proDetail.html",controller:"proDetailController"}).when("/cartList",{templateUrl:"./templates/cartList.html",controller:"cartListController"}).when("/createOrder",{templateUrl:"./templates/createOrder.html",controller:"createOrderController"}).when("/orderList",{templateUrl:"./templates/orderList.html",controller:"orderListController"}).when("/orderDetail/:orderId",{templateUrl:"./templates/orderDetail.html",controller:"orderDetailController"}).otherwise({redirectTo:"/allPro/all"})}]),NetShop.config(["$httpProvider",function(o){o.defaults.withCredentials=!0,o.defaults.useXDomain=!0,delete o.defaults.headers.common["X-Requested-With"]}]),NetShop.run(["$rootScope","$cookies","$http","$location",function($rootScope,$cookies,$http,$location){var f;$rootScope.collapsed=!1,$rootScope.showDialogue=!1,$rootScope.showUserLogin=!1,$rootScope.showRegister=!1,$rootScope.$on("cartUpload",function(event){$rootScope.cartNotEmp=!0,$http.get(PUBLIC+"/netshop/buyer/cart/list").then(function(res){$rootScope.cartNum=0;var num=eval(res.data.data.cartItems);num&&($rootScope.cartNum=num.length),$rootScope.cartChaged=!0},function(o){console.log(o)}),$rootScope.cartChaged=!1}),$rootScope.loged=(f=$cookies.get("username"),f?($rootScope.username=f,$rootScope.$broadcast("cartUpload",!0),!0):!($rootScope.username="登录")),$rootScope.categoryType="all",$rootScope.toggle=function(){$rootScope.collapsed=!$rootScope.collapsed;var o=document.querySelectorAll(".navs dd");if($rootScope.collapsed)for(var t=0;t<o.length;t++)o[t].style.transform="translate(0)",o[t].style.transitionDelay="0.2s",o[t].style.transitionDuration=.15*(t+1)+"s";else for(var e=o.length-1,r=e;0<r;r--)o[r].style.transform="translate(-100%)",o[r].style.transitionDelay="",o[r].style.transitionDuration=.15*(e-r)+"s"},$rootScope.toggleDialog=function(){$rootScope.showDialogue=!$rootScope.showDialogue,$rootScope.showDialogue?($rootScope.username="",$rootScope.showUserLogin=!0):($rootScope.showUserLogin=!1,$rootScope.showRegister=!1,$rootScope.collapsed&&$rootScope.toggle())},$rootScope.toCartList=function(){$rootScope.loged?$location.path("/cartList"):(alert("请登录"),$rootScope.toggleDialog())},$rootScope.closeNav=function(o){o&&$rootScope.toggle()},$rootScope.$on("$locationChangeSuccess",function(o,t,e){e!=t&&"/createOrder"!=t.split("?")[0].split("#")[1]&&window.location.reload()}),$rootScope.loged&&$http.get(PUBLIC+"/netshop/buyer/order/listStatus").then(function(o){"success"==o.data.msg?($rootScope.listStatus=o.data.data,console.log($rootScope.listStatus)):alert("网络异常，稍后再试")},function(o){console.log("网络异常，稍后再试")})}]),NetShop.config(["$httpProvider",function(o){o.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=UTF-8",o.defaults.transformRequest=function(o){var t=[];for(var e in o)t.push(e+"="+o[e]);return t.join("&")}}]),angular.module("Controllers",[]).controller("NavController",["$scope","$location","$rootScope","$http","$routeParams","$cookies",function(t,e,r,o,c,s){o.get(PUBLIC+"/netshop/buyer/category/list").then(function(o){if("success"==o.data.msg){t.iconList=["icon-menu","icon-apparel","icon-tie","icon-sports-shoe","icon-shuttlecock","icon-heart-fill"],t.categoryLists=[{categoryName:"全部商品",categoryType:"all"}].concat(o.data.data.slice(1)).concat([{categoryName:"我的订单",categoryType:"order"}]),console.log(t.categoryLists)}else alert("获取商品列表失败，请刷新！")},function(o){alert("获取商品列表失败，请刷新！")}),t.login=function(){0==r.loged&&(r.showUserLogin=!0,r.toggleDialog())},t.userLogout=function(){window.confirm("确定要注销吗？")&&o.get(PUBLIC+"/netshop/buyer/logout").then(function(o){"success"==o.data.msg?(alert("注销成功！"),r.loged=!1,r.toggle(),r.cartNotEmp=!1,s.remove("username"),r.categoryType="all",e.path("/allPro/all")):alert("出错了哦，请稍后再试！")},function(o){alert("出错了哦，请稍后再试！")})},t.byCategory=function(o){"order"==(r.categoryType=o)?r.loged?(r.collapsed&&r.toggle(),e.path("/orderList")):(alert("请登录！"),r.toggleDialog()):(r.toggle(),e.path("/allPro/"+o))}}]).controller("allProController",["$scope","$http","$rootScope","$location","$routeParams",function(t,o,e,r,c){e.title="商品列表",e.cartBtn=!1,e.categoryType=c.categoryType,t.vm={},t.vm.page=1,t.isLast=!1,t.nextLoading=!1,e.loaded=!0,t.allProLists=[],t.vm.nextPage=function(){t.vm.busy||(t.vm.busy=!0,t.nextLoading=!0,"all"==c.categoryType&&(c.categoryType=""),o.get(PUBLIC+"/netshop/buyer/product/list",{params:{categoryType:c.categoryType,page:t.vm.page}}).then(function(o){"success"==o.data.msg?(t.nextLoading=!1,t.allProLists=t.allProLists.concat(o.data.data.content),o.data.data.last?(t.isLast=!0,t.vm.busy=!0):(t.vm.page++,t.vm.busy=!1)):alert("获取商品信息失败，稍后再试")},function(o){console.log(o)}))},t.proDetail=function(o){e.collapsed||r.path("/proDetail/"+e.categoryType+"/"+o)}}]).controller("proDetailController",["$scope","$http","$rootScope","$location","$routeParams","$cookies",function(t,o,e,r,c,s){e.title="商品详情",e.categoryType=c.categoryType,e.loaded=!0;var n=c.productId;t.showed=!1,t.num=1,t.numDown=!0,o.get(PUBLIC+"/netshop/buyer/product/detail",{params:{productId:n}}).then(function(o){"success"==o.data.msg?(t.product=o.data.data,t.product.colorChoosed=0,t.product.sizeChoosed=0,t.productColor=t.product.productColor[0]||"",t.productSize=t.product.productSize[0]||"",t.product.proDetailImg=t.product.productDetailImg.split("|"),t.product.productColor=t.product.productColor.split("_"),t.product.productSize?t.product.productSize=t.product.productSize.split("_"):t.product.productSize=[]):alert("网络卡了，稍后再试")},function(o){console.log("网络卡了，稍后再试")}),t.chooseColor=function(o){t.product.colorChoosed=o,t.productColor=t.product.productColor[o],t.color='"'+t.product.productColor[o]+'"'},t.chooseSize=function(o){t.product.sizeChoosed=o,t.productSize=t.product.productSize[o],t.size='"'+t.product.productSize[o]+'"'},t.changeNum=function(o){"-"==o?t.num--:t.num++,t.numDown=t.num<=1},t.toggleDia=function(o){t.showed=!t.showed,o&&(t.type=o)},t.$watch("showed",function(o){o?$(".view").css("overflow-y","hidden"):$(".view").css("overflow-y","scroll")}),t.confirmOrder=function(){if(console.log(t.num),!e.loged)return alert("请登录！"),void e.toggleDialog();console.log(t.num),1==t.type?o.post(PUBLIC+"/netshop/buyer/cart/add",{productId:t.product.productId,productColor:t.productColor,productSize:t.productSize,productQuantity:t.num}).then(function(o){"success"==o.data.msg?(alert("添加购物车成功"),t.showed=!1,e.$broadcast("cartUpload",!0)):alert("请登录")},function(o){console.log("网络异常，请稍后再试")}):2==t.type&&r.path("/createOrder").search({params:[{productColor:t.productColor,productId:t.product.productId,img:t.product.productImgMd,name:t.product.productName,productQuantity:t.num,productSize:t.productSize,productPrice:t.product.productPrice}],total:t.num*t.product.productPrice})}}]).controller("loginController",["$scope","$http","$rootScope","$location","$cookies",function(e,t,r,o,c){e.userLog={},e.userLogin=function(o){o?alert("输入信息有误！"):t.post(PUBLIC+"/netshop/buyer/login",e.userLog).then(function(o){if("success"==o.data.msg){alert("登录成功！"),r.toggleDialog(),r.loged=!0,r.userName=e.userLog.username,r.toggle();var t=new Date;t.setHours(t.getHours()+1),c.put("username",e.userLog.username,{expires:t}),e.userLog={},window.location.reload()}},function(o){alert("用户名或密码错误！")})},e.forgetPwd=function(){},e.register=function(){r.showUserLogin=!1,r.showRegister=!0}}]).controller("registerController",["$scope","$http","$rootScope",function(e,r,c){e.registerInfo={},e.userRegister=function(o){if(o)alert("输入信息有误!");else{var t={username:e.registerInfo.newName,password:e.registerInfo.newPwd,phone:e.registerInfo.phone,email:e.registerInfo.email};r({method:"post",url:PUBLIC+"/netshop/buyer/save",data:t}).then(function(o){alert("注册成功！请登录"),e.registerInfo={},c.showRegister=!1,c.showUserLogin=!0},function(o){alert("注册"+o)})}}}]).controller("createOrderController",["$scope","$http","$rootScope","$location","$routeParams",function(t,e,r,c,o){r.title="创建订单",r.loaded=!0,t.products=o.params,t.total=o.total,t.products[0].productId||(t.products=[],history.go("-1"));var s="",n=[];t.createOrder=function(){for(var o=0;o<t.products.length;o++)n.push({itemId:t.products[o].itemId||"",productColor:t.products[o].productColor,productId:t.products[o].productId,productQuantity:t.products[o].productQuantity,productSize:t.products[o].productSize});s=JSON.stringify(n),e.post(PUBLIC+"/netshop/buyer/order/create",{buyerName:t.orderName,buyerPhone:t.phone,buyerAddress:t.addr,items:s}).then(function(o){"success"==o.data.msg?(alert(o.data.data.msg),n=[],r.$broadcast("cartUpload",!0),c.path("/orderDetail/"+o.data.data.orderId)):alert(o.data.msg)},function(o){alert("加购物车！"+o)})}}]).controller("cartListController",["$scope","$http","$rootScope","$location","$routeParams","$cookies",function($scope,$http,$rootScope,$location,$routeParams,$cookies){$rootScope.title="我的购物车",$rootScope.loaded=!0,$scope.cartLists=[],$scope.items=[],$scope.checkAll=!1,$scope.checkNum=0,$http.get(PUBLIC+"/netshop/buyer/cart/list").then(function(res){if("success"==res.data.msg){if(res.data.data.cartItems){var lists=eval(res.data.data.cartItems);lists.map(function(o,t){$scope.cartLists.push(Object.assign({},o,{checked:!1}))})}}else alert("请登录"),$rootScope.toggleDialog()},function(o){console.log("登录"+o)}),$scope.proNumChange=function(o,t){if("rv"==o){if($scope.cartLists[t].productQuantity<=1)return;$http.get(PUBLIC+"/netshop/buyer/cart/decrease",{params:{itemId:$scope.cartLists[t].itemId}}).then(function(o){"success"==o.data.msg?$scope.cartLists[t].productQuantity--:alert("网络出错了，稍等一下！")},function(o){alert("网络出错了，稍等一下！")})}else $http.get(PUBLIC+"/netshop/buyer/cart/increase",{params:{itemId:$scope.cartLists[t].itemId}}).then(function(o){"success"==o.data.msg?$scope.cartLists[t].productQuantity++:alert("网络出错了，稍等一下！")},function(o){console.log("网络出错了，稍等一下！")})},$scope.delete=function(e){window.confirm("确定删除该商品吗？")&&$http.get(PUBLIC+"/netshop/buyer/cart/delete",{params:{itemId:$scope.cartLists[e].itemId}}).then(function(o){if("success"==o.data.msg){var t=$scope.cartLists;$scope.cartLists=t.slice(0,e).concat(t.slice(e+1)),$rootScope.cartNum--}else alert("网络出错了，稍等一下！")},function(o){console.log("删除该商品"+o)})},$scope.checkAllPros=function(){if(!$rootScope.collapsed){$scope.checkAll=!$scope.checkAll;for(var o=0;o<$scope.cartLists.length;o++)$scope.cartLists[o].checked=$scope.checkAll}},$scope.batchDelete=function(){if(0==$scope.checkNum)alert("请至少选择一件商品！");else{if(!window.confirm("确定删除"+$scope.items.length+"件商品吗？"))return;var o=$scope.items.join("_");$http.get(PUBLIC+"/netshop/buyer/cart/batchDelete",{params:{itemIds:o}}).then(function(o){"success"==o.data.msg?history.go(0):alert("出错了，稍后再试")},function(o){console.log("删除"+o)})}},$scope.$watch("cartLists",function(){$scope.cartTotal=0,$scope.items=[],$scope.itemsDetail=[];for(var o=$scope.checkNum=0;o<$scope.cartLists.length;o++)$scope.cartLists[o].checked&&($scope.cartTotal+=parseFloat($scope.cartLists[o].productPrice*$scope.cartLists[o].productQuantity),$scope.checkNum++,$scope.items.push($scope.cartLists[o].itemId),$scope.itemsDetail.push({itemId:$scope.cartLists[o].itemId,productColor:$scope.cartLists[o].productColor,productId:$scope.cartLists[o].productId,img:$scope.cartLists[o].productImgMd,name:$scope.cartLists[o].productName,productQuantity:$scope.cartLists[o].productQuantity,productSize:$scope.cartLists[o].productSize,productPrice:$scope.cartLists[o].productPrice}));0!=$scope.checkNum&&(console.log($scope.checkNum+"-----"+$scope.cartLists.length),$scope.checkNum==$scope.cartLists.length?$scope.checkAll=!0:$scope.checkAll=!1)},!0),$scope.createOrder=function(){console.log("结算"),$scope.itemsDetail.length?$location.path("/createOrder").search({params:$scope.itemsDetail,total:$scope.cartTotal}):alert("请选择要购买的商品！")}}]).controller("orderListController",["$scope","$http","$rootScope","$location","$routeParams","$cookies",function(e,o,t,r,c,s){t.title="我的订单",t.categoryType="order",t.loaded=!0,e.vm={},e.vm.page=1,e.isLast=!1,e.orderLists=[],e.nextloaded=!1,e.vm.nextPage=function(){e.vm.busy||(e.vm.busy=!0,o.get(PUBLIC+"/netshop/buyer/order/list",{params:{page:e.vm.page}}).then(function(o){e.nextloaded=!0,"success"==o.data.msg?(e.orderLists=e.orderLists.concat(o.data.data.content),o.data.data.last?(e.isLast=!0,e.vm.busy=!0):(e.vm.page++,e.vm.busy=!1)):console.log("获取商品信息失败，稍后再试")},function(o){console.log("获取商品信息失败，稍后再试err")}))},e.delOrder=function(t){window.confirm("该订单信息将被删除，不再显示在订单页，是否继续？")&&o.get(PUBLIC+"/netshop/buyer/order/delete",{params:{orderId:e.orderLists[t].orderId}}).then(function(o){"success"==o.data.msg&&(alert("删除成功"),e.orderLists=e.orderLists.slice(0,t).concat(e.orderLists.slice(t+1)))},function(o){console.log("删除成功"+o)})},e.cancelOrder=function(t){window.confirm("取消该订单吗？")&&o.get(PUBLIC+"/netshop/buyer/order/cancel",{params:{orderId:e.orderLists[t].orderId}}).then(function(o){"success"==o.data.msg&&(alert("取消成功!"),e.orderLists[t].orderStatus="2")},function(o){console.log("取消成功order!")})},e.orderDetail=function(o){t.collapsed||r.path("/orderDetail/"+e.orderLists[o].orderId)}}]).controller("orderDetailController",["$scope","$http","$rootScope","$location","$routeParams","$cookies",function(t,e,o,r,c,s){o.title="订单详情",o.categoryType="order",o.loaded=!0,e.get(PUBLIC+"/netshop/buyer/order/detail",{params:{orderId:c.orderId}}).then(function(o){"success"==o.data.msg?t.orderDetail=o.data.data:alert("网络出错了，稍后再试")},function(o){console.log("orderDetail"+o)}),t.delOrder=function(o){window.confirm("该订单信息将被删除，不再显示在订单页，是否继续？")&&e.get(PUBLIC+"/netshop/buyer/order/delete",{params:{orderId:o}}).then(function(o){"success"==o.data.msg&&(alert("删除成功"),history.go(-1))},function(o){console.log("网络异常，稍后再试")})},t.cancelOrder=function(o){window.confirm("取消该订单吗？")&&e.get(PUBLIC+"/netshop/buyer/order/cancel",{params:{orderId:o}}).then(function(o){"success"==o.data.msg&&(alert("取消成功"),t.orderDetail.orderStatus="2")},function(o){console.log("取消成功"+o)})}}]),angular.module("Directives",[]).directive("loading",function(){return{restrict:"A",replace:!0,template:'<img src="" alt="" />'}}).directive("ngCheck",function(){var c="ng-checked";return{restrict:"A",require:"ngModel",link:function(t,e,o,r){r.$checked=!0,e.bind("focus",function(o){e.addClass(c),t.$apply(function(){r.$checked=!0})}).bind("blur",function(o){e.removeClass(c),t.$apply(function(){r.$checked=!1})})}}}).directive("ensureUnique",["$http",function(c){return{require:"ngModel",link:function(t,o,e,r){o.bind("focus",function(){r.$setValidity("unique",!0)}).bind("blur",function(){var o="http://106.14.183.207:8085/netshop/buyer/"+e.ensureUnique+"?"+e.name+"="+t[e.ngModel];console.log(o),null!=t[e.ngModel]&&c.get(o).then(function(o){"success"==o.data.msg?r.$setValidity("unique",!0):r.$setValidity("unique",!1)},function(o){r.$setValidity("unique",!1),console.log("网络出错啦，稍后再试哦")})})}}}]).directive("ensureSame",[function(){return{require:"ngModel",link:function(o,t,e,r){t.bind("focus",function(){r.$setValidity("same",!0)}).bind("blur",function(){o.newPwd==o.repwd?r.$setValidity("same",!0):r.$setValidity("same",!1)})}}}]).directive("orderStatus",function(){return{restrict:"A",template:"<span>{{status}}</span>",replace:!0,controller:["$scope","$element","$attrs","$rootScope",function(t,o,e,r){t.$watch(e.orderStatus,function(o){r.listStatus&&(t.status=r.listStatus[o])})}]}}).directive("logisticsInfo",function(){return{restrict:"A",template:"<p>{{logInfo}}</p>",link:function(t,o,e){t.$watch(e.logisticsInfo,function(o){switch(o){case"0":return void(t.logInfo="请尽快付款哦，亲");case"1":return void(t.logInfo="订单已取消");case"2":return void(t.logInfo="卖家处理中，等待发货");case"3":return void(t.logInfo="退款中，请耐心等待");case"4":return void(t.logInfo="包裹已寄出，请耐心等待");case"5":return void(t.logInfo="订单已结束，欢迎下次光临！")}})}}}).directive("navCollapse",function(){return{restrict:"A",scope:!1,link:function(o,t,e){o.$watch(e.navCollapse,function(o){o?$(".view").css("overflow-y","hidden"):$(".view").css("overflow-y","scroll")})}}}),$(function(){document.documentElement.style.fontSize=window.innerWidth/20+"px",$(".body").css("height","27.375rem")});