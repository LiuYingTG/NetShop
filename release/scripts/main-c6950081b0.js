window.PUBLIC="http://106.14.183.207:8085";var NetShop=angular.module("NetShop",["ngRoute","ngCookies","infinite-scroll","Controllers","Directives"]);function stopPropagation(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}NetShop.config(["$compileProvider",function(t){t.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|file|sms):/)}]),NetShop.config(["$routeProvider","$locationProvider",function(t,o){o.hashPrefix(""),t.when("/allPro/:categoryType",{templateUrl:"./templates/allPro.html",controller:"allProController"}).when("/proDetail/:productId",{templateUrl:"./templates/proDetail.html",controller:"proDetailController"}).when("/cartList",{templateUrl:"./templates/cartList.html",controller:"cartListController"}).when("/createOrder",{templateUrl:"./templates/createOrder.html",controller:"createOrderController"}).when("/orderList",{templateUrl:"./templates/orderList.html",controller:"orderListController"}).when("/orderDetail/:orderId",{templateUrl:"./templates/orderDetail.html",controller:"orderDetailController"}).otherwise({redirectTo:"/allPro/all"})}]),NetShop.config(["$httpProvider",function(t){t.defaults.withCredentials=!0,t.defaults.useXDomain=!0,delete t.defaults.headers.common["X-Requested-With"]}]),NetShop.run(["$rootScope","$cookies","$http","$location",function($rootScope,$cookies,$http,$location){var f;$rootScope.collapsed=!1,$rootScope.showDialogue=!1,$rootScope.showUserLogin=!1,$rootScope.showRegister=!1,$rootScope.$on("cartUpload",function(event){$rootScope.cartNotEmp=!0,$http.get(PUBLIC+"/netshop/buyer/cart/list").then(function(res){$rootScope.cartNum=0;var num=eval(res.data.data.cartItems);num&&($rootScope.cartNum=num.length),$rootScope.cartChaged=!0},function(t){console.log(t)}),$rootScope.cartChaged=!1}),$rootScope.loged=(f=$cookies.get("username"),f?($rootScope.username=f,$rootScope.$broadcast("cartUpload",!0),!0):!($rootScope.username="登录")),$rootScope.categoryType="all",$rootScope.toggle=function(){$rootScope.collapsed=!$rootScope.collapsed;var t=document.querySelectorAll(".navs dd");if($rootScope.collapsed)for(var o=0;o<t.length;o++)t[o].style.transform="translate(0)",t[o].style.transitionDelay="0.2s",t[o].style.transitionDuration=.15*(o+1)+"s";else for(var e=t.length-1,r=e;0<r;r--)t[r].style.transform="translate(-100%)",t[r].style.transitionDelay="",t[r].style.transitionDuration=.15*(e-r)+"s"},$rootScope.toggleDialog=function(){$rootScope.showDialogue=!$rootScope.showDialogue,$rootScope.showDialogue?($rootScope.username="",$rootScope.showUserLogin=!0,$(".viewport").css("position","fixed")):($rootScope.showUserLogin=!1,$rootScope.showRegister=!1,$(".viewport").css("position","relative"),$rootScope.toggle())},$rootScope.toCartList=function(){$location.path("/cartList")},$rootScope.closeNav=function(t){t&&$rootScope.toggle()}}]),NetShop.config(["$httpProvider",function(t){t.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=UTF-8",t.defaults.transformRequest=function(t){var o=[];for(var e in t)o.push(e+"="+t[e]);return o.join("&")}}]),angular.module("Controllers",[]).controller("NavController",["$scope","$location","$rootScope","$http","$routeParams","$cookies",function(o,e,r,t,c,s){t.get(PUBLIC+"/netshop/buyer/category/list").then(function(t){if("success"==t.data.msg){o.iconList=["icon-menu","icon-apparel","icon-tie","icon-sports-shoe","icon-shuttlecock","icon-heart-fill"],o.categoryLists=[{categoryName:"全部商品",categoryType:"all"}].concat(t.data.data.slice(1)).concat([{categoryName:"我的订单",categoryType:"order"}])}else alert("获取商品列表失败，请刷新！")},function(t){alert("获取商品列表失败，请刷新！")}),o.login=function(){0==r.loged&&(r.showUserLogin=!0,r.toggleDialog())},o.userLogout=function(){window.confirm("确定要注销吗，亲？")&&t.get(PUBLIC+"/netshop/buyer/logout").then(function(t){"success"==t.data.msg?(alert("注销成功！"),r.loged=!1,r.toggle(),r.cartNotEmp=!1,s.remove("username"),r.categoryType="all",e.path("/allPro/all")):alert("出错了哦，请稍后再试！")},function(t){alert("出错了哦，请稍后再试！")})},o.byCategory=function(t){"order"==(r.categoryType=t)?(r.toggle(),e.path("/orderList")):(r.categoryType=t,r.toggle(),e.path("/allPro/"+t))}}]).controller("allProController",["$scope","$http","$rootScope","$location","$routeParams",function(o,t,c,s,e){c.title="商品列表",c.cartBtn=!1,o.vm={},o.vm.page=1,o.isLast=!1,o.nextLoading=!1,c.loaded=!0,o.allProLists=[],o.vm.nextPage=function(){o.vm.busy||(o.vm.busy=!0,o.nextLoading=!0,"all"==e.categoryType&&(e.categoryType=""),t.get(PUBLIC+"/netshop/buyer/product/list",{params:{categoryType:e.categoryType,page:o.vm.page}}).then(function(t){"success"==t.data.msg?(o.nextLoading=!1,o.allProLists=o.allProLists.concat(t.data.data.content),t.data.data.last?(o.isLast=!0,o.vm.busy=!0):(o.vm.page++,o.vm.busy=!1)):alert("获取商品信息失败，稍后再试")},function(t){alert("获取商品信息失败，稍后再试")}))},o.proDetail=function(t,o,e,r){c.collapsed||s.path("/proDetail/"+t)}}]).controller("proDetailController",["$scope","$http","$rootScope","$location","$routeParams","$cookies",function(o,t,e,r,c,s){e.title="商品详情",e.loaded=!0;var a=c.productId;o.showed=!1,o.num=1,o.numDown=!0,t.get(PUBLIC+"/netshop/buyer/product/detail",{params:{productId:a}}).then(function(t){"success"==t.data.msg?(o.product=t.data.data,o.product.colorChoosed=0,o.product.sizeChoosed=0,o.productColor=o.product.productColor[0]||"",o.productSize=o.product.productSize[0]||"",o.product.proDetailImg=o.product.productDetailImg.split("|"),o.product.productColor=o.product.productColor.split("_"),o.product.productSize?o.product.productSize=o.product.productSize.split("_"):o.product.productSize=[]):alert("网络卡了，稍后再试")},function(t){alert("网络卡了，稍后再试")}),o.chooseColor=function(t){o.product.colorChoosed=t,o.productColor=o.product.productColor[t],o.color='"'+o.product.productColor[t]+'"'},o.chooseSize=function(t){o.product.sizeChoosed=t,o.productSize=o.product.productSize[t],o.size='"'+o.product.productSize[t]+'"'},o.changeNum=function(t){"-"==t?o.num--:o.num++,o.numDown=o.num<=1},o.toggleDialog=function(t){o.showed=!o.showed,t&&(o.type=t)},o.$watch("showed",function(t){t?$(".product").css("position","fixed"):$(".product").css("position","")}),o.confirmOrder=function(){if(!e.loged)return alert("请登录！"),void e.toggleDialog();1==o.type?t.post(PUBLIC+"/netshop/buyer/cart/add",{productId:o.product.productId,productColor:o.productColor,productSize:o.productSize,productQuantity:o.num}).then(function(t){"success"==t.data.msg?(alert("添加购物车成功"),o.showed=!1,e.$broadcast("cartUpload",!0)):alert("请登录")},function(t){alert("网络异常，请稍后再试")}):2==o.type&&r.path("/createOrder").search({params:[{productColor:o.productColor,productId:o.product.productId,img:o.product.productImgMd,name:o.product.productName,productQuantity:o.num,productSize:o.productSize,productPrice:o.product.productPrice}],total:o.num*o.product.productPrice})}}]).controller("loginController",["$scope","$http","$rootScope","$location","$cookies",function(e,t,r,o,c){e.userLog={},e.userLogin=function(){t.post(PUBLIC+"/netshop/buyer/login",e.userLog).then(function(t){if("success"==t.data.msg){alert("登录成功！"),r.toggleDialog(),r.loged=!0,r.userName=e.userLog.username,r.toggle();var o=new Date;o.setHours(o.getHours()+1),c.put("username",e.userLog.username,{expires:o}),e.userLog={},history.go(0)}else alert("用户名或密码错误！")},function(t){alert("用户名或密码错误！")})},e.forgetPwd=function(){},e.register=function(){r.showUserLogin=!1,r.showRegister=!0}}]).controller("registerController",["$scope","$http","$rootScope",function(t,o,e){t.userRegister=function(){o({method:"post",url:PUBLIC+"/netshop/buyer/save",data:{username:t.username,password:t.pwd,phone:t.phone,email:t.email}}).then(function(t){alert("注册成功！请登录"),e.toggleDialog()},function(t){alert("网络错误，请稍后重试")})}}]).controller("createOrderController",["$scope","$http","$rootScope","$location","$routeParams",function(o,e,r,c,t){r.title="创建订单",r.loaded=!0,o.products=t.params,o.products[0].productId||(o.products=[],history.go("-1"));var s="",a=[];o.createOrder=function(){for(var t=0;t<o.products.length;t++)a.push({itemId:o.products[t].itemId||"",productColor:o.products[t].productColor,productId:o.products[t].productId,productQuantity:o.products[t].productQuantity,productSize:o.products[t].productSize});s=JSON.stringify(a),e.post(PUBLIC+"/netshop/buyer/order/create",{buyerName:o.orderName,buyerPhone:o.phone,buyerAddress:o.addr,items:s}).then(function(t){"success"==t.data.msg?(alert(t.data.data.msg),a=[],r.$broadcast("cartUpload",!0),c.path("/orderDetail/"+t.data.data.orderId)):alert(t.data.msg)},function(t){alert("网络错误，稍后再试！")})}}]).controller("cartListController",["$scope","$http","$rootScope","$location","$routeParams","$cookies",function($scope,$http,$rootScope,$location,$routeParams,$cookies){$rootScope.title="我的购物车",$rootScope.loaded=!0,$scope.cartLists=[],$scope.items=[],$rootScope.loged?($scope.checkAll=!1,$scope.checkNum=0,$http.get(PUBLIC+"/netshop/buyer/cart/list").then(function(res){if("success"==res.data.msg){if(res.data.data.cartItems){var lists=eval(res.data.data.cartItems);lists.map(function(t,o){$scope.cartLists.push(Object.assign({},t,{checked:!1}))})}}else alert("请登录"),history.go(-1)},function(t){alert("网络错误，稍后重试")})):(alert("请登录！"),$rootScope.toggleDialog()),$scope.proNumChange=function(t,o){if("rv"==t){if($scope.cartLists[o].productQuantity<=1)return;$http.get(PUBLIC+"/netshop/buyer/cart/decrease",{params:{itemId:$scope.cartLists[o].itemId}}).then(function(t){"success"==t.data.msg?$scope.cartLists[o].productQuantity--:alert("网络出错了，稍等一下！")},function(t){alert("网络出错了，稍等一下！")})}else $http.get(PUBLIC+"/netshop/buyer/cart/increase",{params:{itemId:$scope.cartLists[o].itemId}}).then(function(t){"success"==t.data.msg?$scope.cartLists[o].productQuantity++:alert("网络出错了，稍等一下！")},function(t){alert("网络出错了，稍等一下！")})},$scope.delete=function(e){window.confirm("确定删除该商品吗？")&&$http.get(PUBLIC+"/netshop/buyer/cart/delete",{params:{itemId:$scope.cartLists[e].itemId}}).then(function(t){if("success"==t.data.msg){var o=$scope.cartLists;$scope.cartLists=o.slice(0,e).concat(o.slice(e+1)),$rootScope.cartNum--}else alert("网络出错了，稍等一下！")},function(t){alert("网络出错了，稍等一下！")})},$scope.checkAllPros=function(){$scope.checkAll=!$scope.checkAll;for(var t=0;t<$scope.cartLists.length;t++)$scope.cartLists[t].checked=$scope.checkAll},$scope.batchDelete=function(){if(window.confirm("确定删除"+$scope.items.length+"件商品吗，亲？")){var t=$scope.items.join("_");$http.get(PUBLIC+"/netshop/buyer/cart/batchDelete",{params:{itemIds:t}}).then(function(t){"success"==t.data.msg?history.go(0):alert("出错了，稍后再试")},function(t){alert("出错了，稍后再试")})}},$scope.$watch("cartLists",function(){$scope.cartTotal=0,$scope.items=[],$scope.itemsDetail=[];for(var t=$scope.checkNum=0;t<$scope.cartLists.length;t++)$scope.cartLists[t].checked&&($scope.cartTotal+=parseFloat($scope.cartLists[t].productPrice*$scope.cartLists[t].productQuantity),$scope.checkNum++,$scope.items.push($scope.cartLists[t].itemId),$scope.itemsDetail.push({itemId:$scope.cartLists[t].itemId,productColor:$scope.cartLists[t].productColor,productId:$scope.cartLists[t].productId,img:$scope.cartLists[t].productImgMd,name:$scope.cartLists[t].productName,productQuantity:$scope.cartLists[t].productQuantity,productSize:$scope.cartLists[t].productSize,productPrice:$scope.cartLists[t].productPrice}))},!0),$scope.createOrder=function(){$location.path("/createOrder").search({params:$scope.itemsDetail,total:$scope.cartTotal})}}]).controller("orderListController",["$scope","$http","$rootScope","$location","$routeParams","$cookies",function(e,t,o,r,c,s){o.title="我的订单",o.loaded=!0,e.vm={},e.vm.page=1,e.isLast=!1,e.orderLists=[],e.nextloaded=!1,t.get(PUBLIC+"/netshop/buyer/order/listStatus").then(function(t){"success"==t.data.msg?o.listStatus=t.data.data:alert("网络异常，稍后再试")},function(t){alert("网络异常，稍后再试")}),o.loged?e.vm.nextPage=function(){e.vm.busy||(e.vm.busy=!0,t.get(PUBLIC+"/netshop/buyer/order/list",{params:{page:e.vm.page}}).then(function(t){e.nextloaded=!0,"success"==t.data.msg?(e.orderLists=e.orderLists.concat(t.data.data.content),t.data.data.last?(e.isLast=!0,e.vm.busy=!0):(e.vm.page++,e.vm.busy=!1)):alert("获取商品信息失败，稍后再试")},function(t){alert("获取商品信息失败，稍后再试")}))}:(alert("请登录！"),o.toggleDialog()),e.delOrder=function(o){window.confirm("该订单信息将被删除，不再显示在订单页，是否继续？")&&t.get(PUBLIC+"/netshop/buyer/order/delete",{params:{orderId:e.orderLists[o].orderId}}).then(function(t){"success"==t.data.msg&&(alert("删除成功"),e.orderLists=e.orderLists.slice(0,o).concat(e.orderLists.slice(o+1)))},function(t){alert("网络异常，稍后再试")})},e.cancelOrder=function(o){window.confirm("取消该订单吗？")&&t.get(PUBLIC+"/netshop/buyer/order/cancel",{params:{orderId:e.orderLists[o].orderId}}).then(function(t){"success"==t.data.msg&&(alert("取消成功!"),e.orderLists[o].orderStatus="2")},function(t){alert("网络异常，稍后再试!")})},e.orderDetail=function(t){r.path("/orderDetail/"+e.orderLists[t].orderId)}}]).controller("orderDetailController",["$scope","$http","$rootScope","$location","$routeParams","$cookies",function(o,e,t,r,c,s){t.title="订单详情",t.loaded=!0,e.get(PUBLIC+"/netshop/buyer/order/detail",{params:{orderId:c.orderId}}).then(function(t){"success"==t.data.msg?o.orderDetail=t.data.data:alert("网络出错了，稍后再试")},function(t){alert("网络出错了，稍后再试")}),o.delOrder=function(t){window.confirm("该订单信息将被删除，不再显示在订单页，是否继续？")&&e.get(PUBLIC+"/netshop/buyer/order/delete",{params:{orderId:t}}).then(function(t){"success"==t.data.msg&&(alert("删除成功"),history.go(-1))},function(t){alert("网络异常，稍后再试")})},o.cancelOrder=function(t){window.confirm("取消该订单吗？")&&e.get(PUBLIC+"/netshop/buyer/order/cancel",{params:{orderId:t}}).then(function(t){"success"==t.data.msg&&(alert("取消成功"),o.orderDetail.orderStatus="2")},function(t){alert("网络异常，稍后再试")})}}]),angular.module("Directives",[]).directive("loading",function(){return{restrict:"A",replace:!0,template:'<img src="" alt="" />'}}).directive("ngCheck",function(){var c="ng-checked";return{restrict:"A",require:"ngModel",link:function(o,e,t,r){r.$checked=!0,e.bind("focus",function(t){e.addClass(c),o.$apply(function(){r.$checked=!0})}).bind("blur",function(t){e.removeClass(c),o.$apply(function(){r.$checked=!1})})}}}).directive("ensureUnique",["$http",function(c){return{require:"ngModel",link:function(o,t,e,r){t.bind("focus",function(){r.$setValidity("unique",!0)}).bind("blur",function(){var t="http://106.14.183.207:8085/netshop/buyer/"+e.ensureUnique+"?"+e.ngModel+"="+o[e.ngModel];null!=o[e.ngModel]&&c.get(t).then(function(t){"success"==t.data.msg?r.$setValidity("unique",!0):(console.log("存在"),r.$setValidity("unique",!1))},function(t){r.$setValidity("unique",!1),console.log("网络出错啦，稍后再试哦")})})}}}]).directive("ensureSame",[function(){return{require:"ngModel",link:function(t,o,e,r){o.bind("focus",function(){r.$setValidity("same",!0)}).bind("blur",function(){t.pwd==t.repwd?r.$setValidity("same",!0):r.$setValidity("same",!1)})}}}]).directive("orderStatus",function(){return{restrict:"A",template:"<span>{{status}}</span>",replace:!0,link:function(o,t,e,r){console.log(r.listStatus),o.$watch(e.orderStatus,function(t){switch(t){case"0":return void(o.status="未完成");case"1":return void(o.status="已完成");case"2":return void(o.status="已取消")}})},controller:function(t){}}}).directive("logisticsInfo",function(){return{restrict:"A",template:"<p>{{logInfo}}</p>",link:function(o,t,e){o.$watch(e.logisticsInfo,function(t){switch(t){case"0":return void(o.logInfo="订单处理中");case"1":return void(o.logInfo="订单已结束，欢迎下次光临");case"2":return void(o.logInfo="该订单已取消")}})}}}).directive("navCollapse",function(){return{restrict:"A",scope:!1,link:function(t,o,e){t.$watch(e.navCollapse,function(t){t?$(".viewport").css("position","fixed"):$(".viewport").css("position","")})}}}),$(function(){document.documentElement.style.fontSize=window.innerWidth/20+"px",window.alert=function(t){var o=document.createElement("IFRAME");o.style.display="none",o.setAttribute("src","data:text/plain,"),document.documentElement.appendChild(o),window.frames[0].window.alert(t),o.parentNode.removeChild(o)}});